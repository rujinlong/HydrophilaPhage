---
title: "12-phage_genome"
title-block-banner: true
author:
  - name: Jinlong Ru
    orcid: 0000-0002-6757-6018
date: 2024-12-09
toc: true
toc-depth: 4
number-sections: true
code-fold: true
code-line-numbers: true
code-tools: true
format: 
  html:
    embed-resources: true
    smooth-scroll: true
    page-layout: full
reference-location: section
citation-location: document
params:
  name: "12-phage_genome"
---

```{r setup}
#| message: false
#| include: false
#| warning: false
setwd(here::here("analyses"))
params <- list(name = "12-phage_genome")
here::i_am(paste0(params$name, ".qmd"), uuid = "78c65b38-67d9-4cad-a701-9cda22361a70")
projthis::proj_create_dir_target(params$name, clean = FALSE)
path_target <- projthis::proj_path_target(params$name)
path_source <- projthis::proj_path_source(params$name)
path_raw <- path_source("00-raw")
path_resource <- here::here(path_raw, "d00-resource")
path_data <- here::here(path_raw, paste0("d", params$name))
dir.create(path_raw, recursive = TRUE, showWarnings = FALSE)
dir.create(path_data, recursive = TRUE, showWarnings = FALSE)
dir.create(path_resource, recursive = TRUE, showWarnings = FALSE)
```



```{r}
#| label: packages
#| message: false
suppressPackageStartupMessages({
  library(here)
  library(tidyverse)
  library(data.table)
  library(geneviewer)
  devtools::load_all()
})
```


## Tasks

1. The genome of vB_AhyM_Hp3 was assembled using [Unicycler](https://github.com/rrwick/Unicycler). 

2. Assembled genome was annotated using [Pharokka](https://github.com/gbouras13/pharokka) and [Phold](https://github.com/gbouras13/phold).

3. [vConTACT3](https://bitbucket.org/MAVERICLab/vcontact3) was used to cluster vB_AhyM_Hp3 with NCBI viral RefSeq genomes.

```{r}
#| label: gbk-to-tsv

file_gbk <- here(path_data, "phynteny.gbk")
gbk <- read_gbk(file_gbk)

df_cds <- gbk$phynteny$FEATURES$CDS %>%
  purrr::map_dfr(~ list(
    locus_tag   = .x[["locus_tag"]],
    translation = .x[["translation"]],
    region      = .x[["region"]],
    `function`  = .x[["function"]],
    product     = .x[["product"]]
  )) %>%
  tidyr::separate(region, into = c("region_start", "region_end"), sep = "\\.\\.", convert = TRUE) %>% 
  dplyr::mutate(locus_tag = str_replace(locus_tag, "_CDS", ""))

fwrite(df_cds, path_target("phage_cds.tsv"), sep = "\t")
```

## Files written

These files have been written to the target directory, `r paste0("data/", params$name)`:

```{r list-files-target}
projthis::proj_dir_info(path_target(), tz = "CET")
```
